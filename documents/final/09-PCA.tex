% vim: spell spelllang=en:
%! TEX root = **/00-main.tex

% PCA analysis for numerical variables:

\section{PCA analysis for numerical variables}%
\label{sec:pca_analysis_for_numerical_variables}

% Scree plot. Specify how many principal components are selected
\subsection{Scree plot}%
\label{sub:scree_plot}


\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{pca_fact-screeplot} % PCA-inertia_cum
    \caption{PCA inertia}%
    \label{fig:pca_inertia}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{PCA-inertia_cum}
    \caption{PCA accumulated inertia}%
    \label{fig:pca_inertia_cum}
\end{figure}

\vspace{-1em}
We used the inertia plots to decide the number of factorial axis to analyse. In
\cref{fig:pca_inertia} we can conclude the 4 first axis represent a much
larger amount of variance compared to the others. When looking at
\cref{fig:pca_inertia_cum} we can see that the first 4 axis already contain 63\%
of the variance. If we analyse further with the elbow method we can clearly see
that the slop starts to decrease at around the 4\ts{th} axis. Therefore we decided to
only further analyse the first 4 factorial axis.

% 20.24968405 17.88042469 13.04514781 12.39547495
% 20.24968  38.13011  51.17526  63.57073     %  69.09301  74.04671  78.51992  82.73880

\begin{table}[H]
    \caption{Eigenvalues \& variance percentage of first 5 Dimensions}%
    \label{tab:eig}
    \input{../../analysis/tables/pca_fact-eig}
\end{table}

\begin{table}[H]
    \caption{Variable contribution to each axis}%
    \label{tab:}
    \input{../../analysis/tables/pca_fact-contrib}
\end{table}

% Factorial map visualisation:
\subsection{Factorial map visualisation}%
\label{sub:factorial_map_visualisation}

% #2 -> caption #3 -> file, #1 -> page
\newcommand{\factorialmap}[2]{
    \begin{landscape}
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.87\linewidth]{pca_fact-plane_#1_#2-bi}
        \caption{PCA plane #1 vs #2}%
        \label{fig:plane_#1-#2}
    \end{figure}
    \end{landscape}
}

\newcommand{\factvar}[2]{
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.67\textwidth]{pca_fact-plane_#1_#2-var}
        \caption{PCA plane #1 vs #2 (numerical)}%
        \label{fig:plane_#1-#2-var}
    \end{figure}
}

\newcommand{\factorialmapCV}[2]{
    \contrib{#1}{#2}
    \factvar{#1}{#2}
}

\newcommand{\contrib}[2]{
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.85\linewidth]{pca_fact-plane_#1_#2-contrib}
        \caption{PCA variable contributions of plane #1 vs #2}%
        \label{fig:contrib_plane_#1-#2}
    \end{figure}
}

\newcommand{\categorica}[4]{
    \begin{figure}[H]
        \centering
        \includegraphics[width=0.85\linewidth]{pca_fact-#3-plane_#1_#2}
        \caption{PCA variable contributions of #4 in plane #1 vs #2}%
        \label{fig:cat-#3-plane-#1-#2}
    \end{figure}
}

%TODO

\factorialmap{1}{2}

In \cref{fig:plane_1-2} we are showing the factorial maps that represent the most variance among all our factorial axis. When looking at the numerical variables represented we can see that all the variables
related to reviews tend to have similar arrows, this makes sense 
because in the bivariate analysis we concluded that they were correlated.
Looking at \cref{fig:contrib_plane_1-2} we can see that the variables
with higher contribution are the ones about review scores and availability. As all review score variables have a small angle to the first factorial axis we can begin to speculate that this axis is 
mostly affected by these variables. Other variables like availability
and accommodates seem to contribute mostly to the second factorial axis, however these angles aren't as tight so they probably affect the first axis as well.

\factorialmapCV{1}{2}


\factorialmap{1}{3}
In \cref{fig:plane_1-3} we can see that it seems to hold true that 
the review score variables affects axis 1 the most. It is pretty clear that the latent variables associated to the 
first factorial map might be the reviews score variables. When looking at accommodates, beds and 
bedrooms we see that they have similar arrows, that again makes sense because there is some 
correlation between them. These 3 seem to contribute much more to the third factorial axis.

\factorialmapCV{1}{3}

\factorialmap{1}{4}
The plane in \cref{fig:plane_1-4} seems to be mostly affected by review scores and the number of reviews.
In this specific plane number of reviews and accommodates seem to have a similar contribution but with
inverse relation. We can maybe relate the availability with the first plane, but as the global correlation
to this plane of this variable isn't has high we can't derive to much from this.


\factorialmapCV{1}{4}


\factorialmap{2}{3}
In \cref{fig:contrib_plane_2-3} the most contributing variables are the availabilities, accommodates and bedrooms.
These particular plot doesn't help us much in regards to finding associations with the axis because the
angles the variables form are too wide.
\factorialmapCV{2}{3}


\factorialmap{2}{4}
What we can extract when analysing \cref{fig:plane_1-3} is that the availability variables have 
a relatively high contribution and form a very small angle with the second factorial axis.

\factorialmapCV{2}{4}

\factorialmap{3}{4}
When looking at \cref{fig:plane_3-4} we can see that the variable arrows seem to group in 3 different groups: the ones regarding number of reviews, the ones about availability and others related to accommodates and bedroom. If we analyse \cref{fig:contrib_plane_3-4} we can see that the ones that contribute the most are bedrooms, accommodates 
and reviews per month. It is hard to interpret the latent variables associated using this particular figure because the most contributing variables have large angles to both axis.

\factorialmapCV{3}{4}

\begin{landscape}

\categorica{1}{2}{room_type}{room type}
\categorica{1}{3}{room_type}{room type}
\categorica{1}{4}{room_type}{room type}

\subsection{Conclusion}%
What we can conclude after analysing how the variables are distributed along each factorial axis is 
that our variables generally distribute in 4 groups: the ones about availability, 
the ones about review scores, the ones regarding number of reviews and finally beds and accommodation.

After studying each factorial axis in depth we can concluded that the latent variables associated to 
the first factorial map are the ones that talk about review scores. We reached these conclusion after
seeing that in all PCA plots with with the first factorial axis, these variables were top contributors
and their angles to the first axis were really small. The relation seems to be direct as in all plots 
they appear in the positive first axis. Although this relation appears in all plots where factorial
axis 1 appears we think \cref{fig:plane_1-3} depicts this relation the best. 

We conclude that the PCA visualization was an overall success because we were able to detect some grouped
variables and relate some of them to our factorial axis. In fact, we ended up associating the first axis
with the review score variables. This is a major success because the first factorial axis is the one
that represents more variance and therefore associating a meaning to it could help us better explain
out variables.

\end{landscape}

% (Be sure you use a single landscape pager for each single map in order to
% guarantee visibility of materials to the readers)

% For each factorial map provide:

% - Individuals projections

% - Common projection of numerical variables and modalities of qualitative
% - variables (take care to use correct color codes as explained along the course)

% - Interpretation of relationships among variables observed. When possible,
% - interpret the latent variable associated with the principal axis

% - Conclusions

% Note: All factorial maps must be placed in a single landscape page that makes
% it visible
